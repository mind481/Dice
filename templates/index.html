<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>던져봐! 어떤 숫자가 나올까?</title>
<style>
  @font-face {
    font-family: 'GongGothicLight';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-10@1.0/GongGothicLight.woff') format('woff');
    font-weight: normal;
    font-style: normal;
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #000; color:#fff; font-family: 'GongGothicLight', sans-serif;
    display:flex; justify-content:center; align-items:center;
  }
  .wrapper{
    width:100%;
    max-width: calc(100vh * 9 / 16);
    aspect-ratio: 9 / 16;
    display:flex; flex-direction:column;
    padding:20px; box-sizing:border-box; background:#000;
    position: relative;
  }
  /* 상단 로고/날짜 */
  .brand { position:absolute; top:16px; left:20px; font-size:14px; line-height:1.2; opacity:.9;}
  .date-top { position:absolute; top:16px; right:20px; font-size:16px; opacity:.9;}

  /* 제목(스샷 느낌 – 첫 줄 살짝 기울임) */
  .title-wrap{ margin-top:60px; text-align:center;}
  .title-line1{ display:inline-block; font-size:30px; font-weight:300; transform: rotate(-12deg); }
  .title-line2{ display:block; font-size:30px; font-weight:300; margin-top:8px; }

  /* 그래프 영역 */
  .stage{ flex:1; display:flex; flex-direction:column; align-items:center; }
  /* 그래프 위/아래 여백 조정 */
  .chart-block{ width:100%; margin-top:24px; }

  .chart{
    height: 300px; /* 막대 전체 높이 고정 */
    display:flex; justify-content:center; align-items:stretch;
    gap:22px; width:100%;
    position: relative; /* 가상요소/라벨 기준 */
  }

  /* 분모 + 점선 */
  .chart::before {
    content:"";
    position:absolute;
    left:20px; right:20px;
    top:70%; /* 선의 높이 (백분율로 조절 가능) */
    border-top:1px dashed #ffd54f; /* 색/형태 조절 */
    pointer-events:none;
  }
  .chart::after {
    content:"⅙";
    position:absolute;
    top:70%;
    left:0px; /* 막대 영역 바깥으로 빼기 */
    transform:translateY(-50%);
    color:#ffd54f;
    font-size:14px;
  }

  /* 막대+라벨 한 컬럼 */
  .bar-col{
    --barW: clamp(42px, 7vw, 42px);
    display:flex; flex-direction:column; align-items:center;
    justify-content:flex-end;
    height:100%;
    gap:8px;
  }

  .bar{
    width: var(--barW);
    height:100%;
    background: rgba(200,200,200,0.25); /* 반투명 회색 */
    border-radius:20px; position:relative; overflow:hidden;
    transition: box-shadow .3s ease;
  }
  .bar-fill{
    position:absolute; left:0; bottom:0; width:100%;
    height:0; /* 초기 높이 0% */
    background: linear-gradient( #ffffff 50%, rgba(255, 255, 255, 0.6) 100%);
    border-radius:20px;
    transition: height 1s ease-out;
    will-change: height;
  }
  .bar.yellow .bar-fill{ background: linear-gradient(to bottom, #ffd54f 0%, #ffffff 60%); }

  /* 퍼센트: bar-fill 상단을 따라다님 */
  .bar-fill .percent {
    position:absolute;
    top: -6px;               /* 꼭대기 살짝 위 */
    left: 50%;
    transform: translate(-50%, -100%);
    color:#fff; font-weight:700; font-size:12px; white-space:nowrap;
    text-shadow: 0 1px 2px rgba(0,0,0,.45);
  }

  /* 막대 아래 라벨(주사위) */
  .bar-label{
    width: var(--barW);
    text-align: center;
    font-size: calc(var(--barW) * 0.9);
    line-height: 1;
  }

  /* 페이저 도트 (그래프 아래, 타이틀 위) */
  .dots { display:flex; gap:8px; justify-content:center; align-items:center; margin:8px 0 6px; }
  .dot{ width:8px; height:8px; border-radius:50%; background:#555; }
  .dot.active{ background:#fff; }

  /* 그래프 타이틀 */
  #chartTitle{ text-align:center; font-size:18px; font-weight:300; margin-bottom:18px; }

  /* 설명 카드 */
  .desc {
    width: 400px;
    height: 160px;
    background: #222;
    border-radius: 16px;
    padding: 20px;
    margin-top: 8px;
    line-height: 1.6;
    box-sizing: border-box;
    position: relative;
    text-align: center;
    font-size: 12px;
    color: rgb(149, 171, 219);
  }
  .desc strong {
    font-size: 18px;    /* 제목 크기 */
  }

  /* 설명 카드 아래 작은 도트 */
  .desc-dots{ display:flex; gap:8px; justify-content:center; align-items:center; margin:8px 0 6px; }
  .desc-dot{ width:6px; height:6px; border-radius:50%; background:#555; }
  .desc-dot.active{ background:#fff; }

  /* 하단 통계 3개 (스샷 배치) */
  .stats-wrap{ margin-top:28px; text-align:center; }
  .stats-title{ font-size:18px; margin-bottom:14px; }
  .stats{ display:flex; justify-content:space-around; margin-top:6px; }
  .stat{ text-align:center; }
  .stat .num{ font-size:40px; font-weight:500; font-style: italic;}
  .stat .lbl{ margin-top:6px; color:#a8c2e8; font-style:italic; }

  /* 강조(반짝) 효과 */
  @keyframes highlightFlash{
    0%,100%{ box-shadow:0 0 0 rgba(255,255,255,0); }
    50%{ box-shadow:0 0 22px rgba(255,255,0,.95); }
  }
  .highlight{ animation: highlightFlash 1s ease-in-out 3; }
</style>
</head>

<body>
  <div class="wrapper">

    <div class="brand">국립중앙과학관<br/><span style="font-size:11px; opacity:.8;">NATIONAL SCIENCE MUSEUM</span></div>
    <div class="date-top" id="dateTop"></div>

    <div class="title-wrap">
      <span class="title-line1">던져봐!</span>
      <span class="title-line2">어떤 숫자가 나올까?</span>
    </div>

    <div class="stage">
      <div class="chart-block">
        <div class="chart" id="chart">
          <!-- 1 -->
          <div class="bar-col">
            <div class="bar">
              <div class="bar-fill"><div class="percent">0%</div></div>
            </div>
            <div class="bar-label">⚀</div>
          </div>
          <!-- 2 -->
          <div class="bar-col">
            <div class="bar">
              <div class="bar-fill"><div class="percent">0%</div></div>
            </div>
            <div class="bar-label">⚁</div>
          </div>
          <!-- 3 -->
          <div class="bar-col">
            <div class="bar">
              <div class="bar-fill"><div class="percent">0%</div></div>
            </div>
            <div class="bar-label">⚂</div>
          </div>
          <!-- 4 -->
          <div class="bar-col">
            <div class="bar">
              <div class="bar-fill"><div class="percent">0%</div></div>
            </div>
            <div class="bar-label">⚃</div>
          </div>
          <!-- 5 -->
          <div class="bar-col">
            <div class="bar yellow">
              <div class="bar-fill"><div class="percent">0%</div></div>
            </div>
            <div class="bar-label">⚄</div>
          </div>
          <!-- 6 -->
          <div class="bar-col">
            <div class="bar">
              <div class="bar-fill"><div class="percent">0%</div></div>
            </div>
            <div class="bar-label">⚅</div>
          </div>
        </div>

        <!-- 그래프 페이저 도트 & 타이틀 -->
        <div class="dots" id="dots"></div>
        <h2 id="chartTitle">오늘의 통계</h2>
      </div>

      <div class="desc" id="desc">
        <div id="descText"></div>
        <div class="desc-dots" id="desc-dots"></div>
      </div>
    </div>

    <div class="stats-wrap">
      <div class="stats-title">나는 몇 번째 체험자일까요?</div>
      <div class="stats">
        <div class="stat">
          <div class="num" id="todayCnt">{{daily_count}}</div>
          <div class="lbl">Today</div>
        </div>
        <div class="stat">
          <div class="num" id="monthCnt">{{monthly_count}}</div>
          <div class="lbl">Monthly</div>
        </div>
        <div class="stat">
          <div class="num" id="totalCnt">{{total_count}}</div>
          <div class="lbl">Total</div>
        </div>
      </div>
    </div>

  </div>

<script>
  // 오늘 날짜 상단 표시
  (function(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    document.getElementById('dateTop').textContent = `${y}-${m}-${day}`;
  })();

  // 데이터셋 (title 추가)
  const chartDatasets = [
    {
      title: "오늘의 통계",
      heights: {{ daily }}
    },
    {
      title: "이번 달의 통계",
      heights: {{ monthly }}
    },
    {
      title: "전체 통계",
      heights: {{ total }}
    }
  ];

  const descDatasets = [
    {
      title: "큰 수의 법칙",
      desc: "<strong>큰 수의 법칙</strong>\
      <br>주사위를 몇 번만 던지면 어떤 숫자가 더 많이 나올 수도 있어요.\
      <br>그런데 주사위를 백 번, 천 번 던져보면 어떻게 될까요?\
      <br>놀랍게도! 모든 숫자가 비슷한 횟수로 나오게 돼요.\
      <br>숫자들이 서로 \"우리도 골고루 나올 차례야~\"하고 줄 서는 것 같죠!"
    },
    {
      title: "도박사의 오류",
      desc: "<strong>도박사의 오류</strong>\
      <br>\"계속 1이 나왔으니 이제 6이 나올 차례\"라고 생각하나요?\
      <br>하지만 주사위는 지난 결과를 기억하지 못해요!\
      <br>언제든지 1도, 6도, 다시 또 1이 나올 수 있죠.\
      <br>주사위는 항상 \'무작위\'로 숫자를 골라요. 지난 결과와는 상관 없어요!"
    }
  ];

  const chartEl   = document.getElementById('chart');
  const bars      = chartEl.querySelectorAll('.bar');
  const fills     = chartEl.querySelectorAll('.bar-fill');
  const percents  = chartEl.querySelectorAll('.bar-fill .percent');
  const descEl    = document.getElementById('desc');
  const titleEl   = document.getElementById('chartTitle');
  const dotsEl = document.getElementById('dots');

  const descTextEl = document.getElementById('descText');
  const descDotsEl = document.getElementById('desc-dots');
  
  // 그래프 도트 생성
  chartDatasets.forEach((_,i)=>{
    const d = document.createElement('div');
    d.className = 'dot' + (i===0?' active':'');
    d.dataset.i = i;
    dotsEl.appendChild(d);
  });

  // 설명 도트 생성
  descDatasets.forEach((_,i)=>{
    const d = document.createElement('div');
    d.className = 'desc-dot' + (i===0?' active':'');
    d.dataset.i = i;
    descDotsEl.appendChild(d);
  });

  // 페이지 토글
  function setChartPager(i){
    dotsEl.querySelectorAll('.dot')
      .forEach((el,idx)=> el.classList.toggle('active', idx===i));
  }
  function setDescPager(i){
    descDotsEl.querySelectorAll('.desc-dot')
      .forEach((el,idx)=> el.classList.toggle('active', idx===i));
  }

  let idx = 0, highlightTimer = null;

  function forceReflow(el){ void el.offsetHeight; }

  function animateTo(heights){
    // 0%로 초기화 (아래→위 재생)
    fills.forEach(f => { f.style.transition = 'none'; f.style.height = '0%'; });
    percents.forEach(v => v.textContent = '0%');
    fills.forEach(forceReflow);

    // 다음 프레임부터 목표치로
    requestAnimationFrame(() => {
      fills.forEach(f => f.style.transition = 'height 1s ease-out');
      requestAnimationFrame(() => {
        const max = Math.max(...heights);
        fills.forEach((f,i) => {
          const h = max > 0? (heights[i] / max * 100) : 0;
          f.style.height = h + '%';
          f.querySelector('.percent').textContent = heights[i];
        });
      });
    });

    // 반짝 효과 (노란 막대 5)
    if (highlightTimer) clearTimeout(highlightTimer);
    const pick = {{ latest_face }} - 1;
    highlightTimer = setTimeout(() => {
      bars.forEach(b => b.classList.remove('highlight'));
      bars[pick].classList.add('highlight');
    }, 1000);
  }

  function updateChartUI(i){
    const d = chartDatasets[i];
    titleEl.textContent = d.title;
    animateTo(d.heights);
    setChartPager(i);
  }
  function updateDescUI(i){
    const d = descDatasets[i];
    descTextEl.innerHTML = d.desc;  // 도트는 건드리지 않음
    setDescPager(i);
  }

  // ===== 인덱스/타이머 완전 분리 =====
  let idxChart = 0;
  let idxDesc  = 0;

  function tickChart(){
    idxChart = (idxChart + 1) % chartDatasets.length;
    updateChartUI(idxChart);
  }
  function tickDesc(){
    idxDesc = (idxDesc + 1) % descDatasets.length;
    updateDescUI(idxDesc);
  }

  // 초기 표시
  updateChartUI(0);
  updateDescUI(0);
  setInterval(tickChart, 5000);
  setInterval(tickDesc, 10000);
</script>
</body>
</html>
